---
- hosts: localhost
  become: yes
  vars:
    validate_certs: 'false'

  tasks:
    - name: Security Policy NSX-T Cloud
      nsxt_policy_security_policy:
        hostname: "{{ nsx_server }}"
        username: "{{ nsx_username }}"
        password: "{{ nsx_password }}"
        validate_certs: "{{ validate_certs }}"
        state: "{{ state | default('present') }}"
        display_name: "{{ policy_name }}"
        domain_id: "{{ domain_id | default('default') }}"
        category: "{{ category_name | default('Application') }}"
        scope: ["{{ policy_scope }}"]
        rules:
          - action: "ALLOW"
            display_name: "{{ rule_name }}"
            source_groups: ["{{ source_group }}"]
            destination_groups: ["{{ destination_group }}"]
            services: ["ANY"]
            scope: ["{{ rule_scope }}"]
      when:
        - nsx_server is defined
        - nsx_username is defined
        - nsx_password is defined
        - validate_certs is defined
        - policy_name is defined
        - policy_scope
        - rule_name
        - source_group is defined
        - destination_group is defined
        - rule_scope is defined